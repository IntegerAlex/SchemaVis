# Cursor Rules for Migrate ChartsDB Project

## Code Style & Architecture

### React Query (TanStack Query)
- **ALWAYS use Tanstack React Query for all data fetching and mutations**
- **NEVER use useEffect for data fetching** - use `useQuery` or `useMutation` instead
- Use React Query hooks for all async operations:
  - `useQuery` for fetching data
  - `useMutation` for mutations (POST, PUT, DELETE)
  - `useQueryClient` for cache invalidation
- Prefer React Query's built-in loading, error, and success states over manual state management

### React Hooks
- **NEVER use useEffect for data fetching** - use React Query instead
- useEffect should only be used for:
  - DOM manipulation
  - Setting up event listeners
  - Cleanup functions
  - Side effects that don't involve data fetching
- Use `useMemo` and `useCallback` appropriately for performance optimization
- Prefer functional components with hooks over class components

### Component Structure
- Use TypeScript for all components
- Use 'use client' directive for client components in Next.js
- Keep components focused and single-responsibility
- Extract reusable UI components to `src/components/ui/`
- Use composition over inheritance

### State Management
- Use React Query for server state
- Use React useState/useReducer for local UI state only
- Avoid prop drilling - use React Query's context or component composition

### File Organization
- Components: `src/components/`
- UI Components: `src/components/ui/`
- Hooks: `src/hooks/`
- Utilities: `src/lib/`
- Types: `src/lib/domain/`

### Styling
- Use Tailwind CSS for styling
- Use `cn()` utility from `@/lib/utils` for conditional classes
- Follow dark mode patterns: `dark:` variants
- Use consistent spacing and color schemes

### Visualizer Layout
- Use resizable panels for side panel and canvas
- Side panel should contain SQL file upload and input
- Canvas should display the diagram visualization
- Reference chartdb components for styling and patterns

### Code Quality
- Write clean, readable code
- Use meaningful variable and function names
- Add TypeScript types for all props and functions
- Handle errors gracefully with React Query error states
- Use proper loading states with React Query's `isPending` or `isLoading`

## Dependencies
- @tanstack/react-query: ^5.62.11
- @xyflow/react: ^12.8.2
- react-resizable-panels: For resizable layout
- lucide-react: For icons
- @radix-ui: For accessible UI primitives

## Anti-patterns to Avoid
- ❌ Using useEffect for data fetching
- ❌ Manual loading/error state management when React Query can handle it
- ❌ Prop drilling for data that should come from React Query
- ❌ Mixing server state and client state unnecessarily
- ❌ Not using TypeScript types

## Best Practices
- ✅ Use React Query for all async operations
- ✅ Use useMemo/useCallback for expensive computations
- ✅ Extract reusable UI components
- ✅ Use proper TypeScript types
- ✅ Handle loading and error states with React Query
- ✅ Keep components small and focused

